import{i as O,j as e,r as S,h as Y,d as G,s as F,N as U}from"./index-DF1D02Hj.js";import{u as J}from"./useDoctorApi-BGMsDjy1.js";import{u as K,a as Q,C as x}from"./index.esm-Bs_MGDSt.js";import{S as N}from"./react-select.esm-DZnH2LNg.js";import{d as X,a as Z}from"./ArrowForward-GdnSVQw-.js";import{r as ee}from"./createSvgIcon-QGnDfLuw.js";import{s as A,w as B}from"./doctorUtils-DbQ9xYY5.js";import{B as y}from"./Box-D4cKv5_V.js";import{B as T}from"./Button-DJQ79VO-.js";import{T as I}from"./Typography-D94uCwLm.js";import{G as c,T as _}from"./TextField-BCa7AWxh.js";import{L as te,A as re,d as oe}from"./AdapterDayjs-C9hUxPF7.js";import{S as se}from"./StaticTimePicker-PD4VRi65.js";import{L as ae}from"./LoadingButton-BPIyvWo9.js";import{b as ie,B as ne,F as le}from"./Menu-C7haSOWu.js";import"./axios-CyFV80k_.js";import"./toPropertyKey-PLuKRk1e.js";import"./isMuiElement-DtCTRzqF.js";import"./mergeSlotProps-BtuCJPHe.js";import"./OutlinedInput-BKrgIPXM.js";import"./Paper-C9iPag-B.js";import"./useThemeProps-B6NQfqaC.js";import"./useThemeProps-wCF_0idl.js";import"./getThemeProps-60JEWZhT.js";import"./IconButton-CVXum2NQ.js";import"./useSlotProps-C21nwL-b.js";import"./MenuItem-BDtCcL-v.js";import"./ListItem-Y1O789Fh.js";import"./Chip-BCCKjiS7.js";import"./CircularProgress-C94875X6.js";var M={},ue=O;Object.defineProperty(M,"__esModule",{value:!0});var $=M.default=void 0,de=ue(ee()),ce=e;$=M.default=(0,de.default)((0,ce.jsx)("path",{d:"M5 20h14v-2H5zM19 9h-4V3H9v6H5l7 7z"}),"Download");const me=()=>({validateNationalId:o=>o?/^\d{14}$/.test(o)?!0:"الرقم القومي يجب أن يكون 14 رقمًا":"الرقم القومي مطلوب",validatePhoneNumber:o=>o?/^\d{11,15}$/.test(o)?!0:"رقم الهاتف يجب أن يكون بين 11 و 15 رقمًا":"رقم الهاتف مطلوب",validateSalary:o=>{if(!o)return"الراتب مطلوب";const s=typeof o=="string"?parseFloat(o):o;return isNaN(s)||!/^\d+(\.\d{1,2})?$/.test(s.toString())?"الراتب يجب أن يكون رقمًا صحيحًا أو عشريًا":!0},validateFileSize:o=>o&&o.size>2097152?(console.log("file size ",o.size>2097152),"حجم الملف يجب أن يكون أقل من 2 ميجابايت"):!0,validateFileType:(o,s)=>o&&!s.includes(o.type)?`نوع الملف يجب أن يكون ${s.join(" أو ")}`:!0}),pe=({doctor:i,onSubmit:m,onBack:f,profileImageUrl:j,unionRegistrationUrl:h,formLoading:o})=>{const{control:s,handleSubmit:C,formState:{errors:l},setValue:n}=K({defaultValues:i}),a=Q({control:s,name:"working_days"}),{validateNationalId:v,validatePhoneNumber:b,validateSalary:u,validateFileSize:g,validateFileType:k}=me();S.useEffect(()=>{n("profile_photo",i.profile_photo),n("union_registration",i.union_registration)},[]),S.useEffect(()=>{if(console.log(i),a){const t={...i.working_hours};Object.keys(t).forEach(r=>{console.log(t),a.some(d=>d.value===r)||delete t[r]}),a.forEach(r=>{const d=r.value;d!==null&&(t[d]||(t[d]={start:null}))}),console.log(i),n("working_hours",t)}},[a,n,i.working_hours]);const[w,z]=S.useState(j),[P,W]=S.useState(!1),E=()=>W(!0),q=()=>W(!1),H=t=>{m(t)};return e.jsxs(y,{sx:{maxWidth:800,margin:"auto",padding:3,".muirtl-14s5rfu-MuiFormLabel-root-MuiInputLabel-root":{zIndex:"0"},".muirtl-2x8kvt-MuiPickersArrowSwitcher-root-MuiTimeClock-arrowSwitcher":{left:"5px",top:"5px"}},children:[e.jsxs(y,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[e.jsx(T,{onClick:f,startIcon:e.jsx(X,{}),children:"رجوع"}),e.jsx(I,{variant:"h4",sx:{ml:2},children:"تعديل بيانات الطبيب"})]}),w&&e.jsx(y,{sx:{position:"relative",cursor:"pointer"},onClick:E,children:e.jsx(y,{component:"img",sx:{width:100,height:100,borderRadius:"50%",objectFit:"cover",marginBottom:2},alt:"صورة الطبيب",src:w})}),e.jsxs("form",{onSubmit:C(H),children:[e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"name",control:s,rules:{required:"الاسم مطلوب"},render:({field:t})=>{var r;return e.jsx(_,{...t,label:"الاسم",fullWidth:!0,error:!!l.name,helperText:(r=l.name)==null?void 0:r.message})}})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"national_id",control:s,rules:{validate:v},render:({field:t})=>{var r;return e.jsx(_,{...t,label:"الرقم القومي",fullWidth:!0,error:!!l.national_id,helperText:(r=l.national_id)==null?void 0:r.message})}})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"phone_number",control:s,rules:{validate:b},render:({field:t})=>{var r;return e.jsx(_,{...t,label:"رقم الهاتف",fullWidth:!0,error:!!l.phone_number,helperText:(r=l.phone_number)==null?void 0:r.message})}})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"profile_photo",control:s,rules:{validate:t=>{if(typeof t=="string"||!t)return!0;const r=g(t);return r!==!0?r:k(t,["image/jpeg","image/png","image/jpg"])}},render:({field:{onChange:t},fieldState:{error:r}})=>e.jsx(_,{type:"file",onChange:d=>{const p=d.target.files;if(p&&p[0]){t(p[0]);const D=new FileReader;D.onload=R=>{var L;const V=(L=R.target)==null?void 0:L.result;z(V)},D.readAsDataURL(p[0])}},fullWidth:!0,error:!!r,helperText:r==null?void 0:r.message,InputLabelProps:{shrink:!0},label:"الصورة الشخصية"})})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"union_registration",control:s,rules:{validate:t=>typeof t=="string"||!t?!0:k(t,["image/jpeg","image/png","image/jpg","application/pdf"])},render:({field:{onChange:t},fieldState:{error:r}})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{type:"file",onChange:d=>{const p=d.target.files;p&&p[0]&&t(p[0])},fullWidth:!0,error:!!r,helperText:r==null?void 0:r.message,InputLabelProps:{shrink:!0},label:"تسجيل النقابة"}),h&&e.jsx(T,{variant:"outlined",color:"primary",startIcon:e.jsx($,{}),onClick:()=>window.open(h,"_blank"),sx:{mt:1},children:"تحميل ملف تسجيل النقابة"})]})})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"scientific_degree",control:s,rules:{required:"الدرجة العلمية مطلوبة"},render:({field:t})=>{var r;return e.jsx(_,{...t,label:"الدرجة العلمية",fullWidth:!0,error:!!l.scientific_degree,helperText:(r=l.scientific_degree)==null?void 0:r.message})}})}),e.jsx(c,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"fixed_salary",control:s,rules:{validate:u},render:({field:t})=>{var r;return e.jsx(_,{...t,label:"الراتب الثابت",fullWidth:!0,type:"number",inputProps:{step:"0.01"},error:!!l.fixed_salary,helperText:(r=l.fixed_salary)==null?void 0:r.message})}})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(x,{name:"specialty",control:s,rules:{required:"التخصص مطلوب"},render:({field:t})=>e.jsx(N,{...t,options:A,placeholder:"اختر التخصص",value:t.value,onChange:r=>t.onChange(r)})})}),e.jsx(c,{item:!0,xs:12,children:e.jsx(x,{name:"working_days",control:s,rules:{required:"أيام العمل مطلوبة"},render:({field:t})=>e.jsx(N,{...t,options:B,isMulti:!0,placeholder:"اختر أيام العمل",value:t.value,onChange:r=>t.onChange(r)})})}),a&&a.map(t=>{var r;return e.jsx(c,{item:!0,xs:12,sm:12,md:6,children:e.jsx(x,{name:`working_hours.${t.value}.start`,control:s,defaultValue:((r=i.working_hours[t.value!==null?t.value:""])==null?void 0:r.start)||null,rules:{required:`وقت بدء العمل ليوم ${t.label} مطلوب`},render:({field:d,fieldState:{error:p}})=>e.jsx(te,{dateAdapter:re,adapterLocale:"ar",children:e.jsx(c,{item:!0,xs:12,sm:12,md:6,lg:6,xl:6,children:e.jsxs(y,{sx:{width:"100%"},children:[e.jsx(I,{variant:"subtitle1",gutterBottom:!0,children:`وقت بدء العمل ليوم ${t.label}`}),e.jsx(se,{value:d.value,onChange:D=>d.onChange(D),slotProps:{actionBar:{actions:[]}},ampm:!1,sx:{width:"100%",maxWidth:"400px","@media (max-width: 600px)":{maxWidth:"300px"}}}),p&&e.jsx(I,{color:"error",variant:"caption",children:p.message})]})})})})},t.value)})]}),e.jsxs(y,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[e.jsx(T,{onClick:f,variant:"outlined",children:"رجوع"}),e.jsx(ae,{type:"submit",variant:"contained",endIcon:e.jsx(Z,{}),loading:o,children:"تحديث بيانات الطبيب"})]})]}),e.jsx(ie,{open:P,onClose:q,closeAfterTransition:!0,slots:{backdrop:ne},slotProps:{backdrop:{timeout:500}},children:e.jsx(le,{in:P,children:e.jsx(y,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bgcolor:"background.paper",boxShadow:24,p:4},children:w&&e.jsx("img",{src:w,alt:"صورة الطبيب",style:{maxWidth:"100%",maxHeight:"80vh"}})})})})]})},Oe=()=>{const i=Y(),m=G(),{updateDoctor:f}=J(),[j,h]=S.useState(!1),[o,s]=S.useState(null);S.useEffect(()=>{var a,v;const n=(a=i.state)==null?void 0:a.editData;if(n){const b={...n,specialty:{value:n.specialty,label:((v=A.find(u=>u.value===n.specialty))==null?void 0:v.label)||n.specialty},working_days:n.week_days.map(u=>{var g;return{value:u.day,label:((g=B.find(k=>k.value===u.day))==null?void 0:g.label)||u.day}}),working_hours:n.week_days.reduce((u,g)=>{const[k,w]=g.date.split(":").map(Number);return g.day!==null&&(u[g.day]={start:oe().hour(k).minute(w)}),u},{})};console.log(b),s(b)}else F.fire({icon:"error",title:"No doctor data provided"}),m("/SystemAdmin/Doctors")},[i.state,m]);const C=async n=>{h(!0);try{const a={...n,specialty:n.specialty.value};console.log(a),console.log(a.id),console.log(a.working_hours);const v=xe(a.working_hours);console.log(v);const b=v.map(u=>u).join(",");console.log(b),await f(a,b),F.fire({icon:"success",title:"",text:"تم تعديل بيانات الطبيب بنجاح"}),m("/SystemAdmin/Doctors")}catch(a){console.error("Error updating doctor:",a),F.fire({icon:"error",title:"Failed to update doctor"})}finally{h(!1)}},l=()=>{m("/SystemAdmin/Doctors")};return o?e.jsx("div",{dir:"rtl",children:e.jsx(pe,{doctor:o,onSubmit:C,onBack:l,profileImageUrl:`http://127.0.0.1:8000${o.profile_photo}`,unionRegistrationUrl:`http://127.0.0.1:8000${o.union_registration}`,formLoading:j})}):e.jsx(U,{})};function xe(i){const m=[];for(const f in i){const j=i[f].start;if(j){const h=j.format("YYYY-MM-DD HH:mm:ss"),s=new Date(h).toTimeString().split(" ")[0];console.log(s),m.push(f,s)}}return console.log(m),m}export{Oe as default};
