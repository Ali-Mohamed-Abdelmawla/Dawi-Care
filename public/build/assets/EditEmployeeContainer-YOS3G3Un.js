import{r as y,j as e,h as F,d as T,s as _,N}from"./index-DF1D02Hj.js";import{u as k}from"./useEmployeeApi-BGNvU3FX.js";import{u as w,C as x}from"./index.esm-Bs_MGDSt.js";import{d as B,a as I}from"./ArrowForward-GdnSVQw-.js";import{S as C}from"./react-select.esm-DZnH2LNg.js";import{w as S}from"./EmployeeUtils-CTSoHGJR.js";import{B as j}from"./Box-D4cKv5_V.js";import{I as W}from"./IconButton-CVXum2NQ.js";import{T as b}from"./Typography-D94uCwLm.js";import{G as u,T as f}from"./TextField-BCa7AWxh.js";import{B as $}from"./Button-DJQ79VO-.js";import{L as A}from"./LoadingButton-BPIyvWo9.js";import"./axios-CyFV80k_.js";import"./createSvgIcon-QGnDfLuw.js";import"./isMuiElement-DtCTRzqF.js";import"./mergeSlotProps-BtuCJPHe.js";import"./OutlinedInput-BKrgIPXM.js";import"./toPropertyKey-PLuKRk1e.js";import"./Paper-C9iPag-B.js";import"./Menu-C7haSOWu.js";import"./useSlotProps-C21nwL-b.js";import"./CircularProgress-C94875X6.js";const L=()=>({validateNationalId:r=>r?/^\d{14}$/.test(r)?!0:"الرقم القومي يجب أن يكون 14 رقمًا":"الرقم القومي مطلوب",validatePhoneNumber:r=>r?/^\d{11,15}$/.test(r)?!0:"رقم الهاتف يجب أن يكون بين 11 و 15 رقمًا":"رقم الهاتف مطلوب",validateSalary:r=>r?/^\d+(\.\d{1,2})?$/.test(r)?!0:"الراتب يجب أن يكون رقمًا صحيحًا أو عشريًا":"الراتب مطلوب",validateFileSize:r=>r&&r.size>2097152?"حجم الملف يجب أن يكون أقل من 2 ميجابايت":!0,validateFileType:(r,a)=>r&&!a.includes(r.type)?`نوع الملف يجب أن يكون ${a.join(" أو ")}`:!0}),q=({employee:s,onSubmit:m,onBack:p,formLoading:h})=>{const{control:n,handleSubmit:r,formState:{errors:a},setValue:o}=w({defaultValues:s});y.useEffect(()=>{s&&(o("name",s.name),o("national_id",s.national_id),o("phone_number",s.phone_number),o("fixed_salary",s.fixed_salary),o("description",s.description),o("overtime_salary",s.overtime_salary),console.log(s))},[s,o]);const{validateNationalId:g,validatePhoneNumber:d,validateSalary:l}=L(),c=i=>{m(i)};return e.jsx(e.Fragment,{children:e.jsxs(j,{sx:{maxWidth:800,margin:"auto",padding:3},children:[e.jsxs(j,{sx:{display:"flex",alignItems:"center",marginBottom:2},children:[e.jsx(W,{onClick:p,sx:{marginRight:1},children:e.jsx(B,{})}),e.jsx(b,{variant:"h4",children:"تعديل بيانات الموظف"})]}),e.jsxs("form",{onSubmit:r(c),children:[e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"name",control:n,rules:{required:"الاسم مطلوب"},render:({field:i})=>{var t;return e.jsx(f,{...i,label:"الاسم",fullWidth:!0,error:!!a.name,helperText:(t=a.name)==null?void 0:t.message})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"national_id",control:n,rules:{validate:g},render:({field:i})=>{var t;return e.jsx(f,{...i,label:"الرقم القومي",fullWidth:!0,error:!!a.national_id,helperText:(t=a.national_id)==null?void 0:t.message})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"phone_number",control:n,rules:{validate:d},render:({field:i})=>{var t;return e.jsx(f,{...i,label:"رقم الهاتف",fullWidth:!0,error:!!a.phone_number,helperText:(t=a.phone_number)==null?void 0:t.message})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"description",control:n,rules:{required:"التوصيف الوظيفي مطلوب"},render:({field:i})=>{var t;return e.jsx(f,{...i,label:"التوصيف الوظيفي",fullWidth:!0,error:!!a.description,helperText:(t=a.description)==null?void 0:t.message})}})}),e.jsx(u,{item:!0,xs:12,sm:6,children:e.jsx(x,{name:"fixed_salary",control:n,rules:{validate:l},render:({field:i})=>{var t;return e.jsx(f,{...i,label:"الراتب الثابت",fullWidth:!0,error:!!a.fixed_salary,helperText:(t=a.fixed_salary)==null?void 0:t.message})}})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(x,{name:"working_days",control:n,rules:{required:"أيام العمل مطلوبة"},render:({field:i,fieldState:{error:t}})=>e.jsxs(j,{children:[e.jsx(C,{...i,options:S,isMulti:!0,placeholder:"اختر أيام العمل"}),t&&e.jsx(b,{color:"error",children:t.message})]})})})]}),e.jsxs(j,{sx:{mt:3,display:"flex",justifyContent:"space-between"},children:[e.jsx($,{onClick:p,variant:"outlined",children:"رجوع"}),e.jsx(A,{type:"submit",variant:"contained",endIcon:e.jsx(I,{}),loading:h,children:"تحديث بيانات الموظف"})]})]})]})})},ne=()=>{const s=F(),m=T(),{updateEmployee:p}=k(),[h,n]=y.useState(!1),[r,a]=y.useState(null);y.useEffect(()=>{var l,c;const d=(l=s.state)==null?void 0:l.editData;if(d){const i={...d,working_days:(c=d.weekdays)==null?void 0:c.map(t=>{var v;return{value:t.day,label:((v=S.find(E=>E.value===t.day))==null?void 0:v.label)||t.day}})};a(i)}else _.fire({icon:"error",title:"حدث خطأ ما",text:"لا يوجد بيانات للتعديل"}),m("/SystemAdmin/Employees")},[s.state,m]);const o=async d=>{n(!0);try{const l={...d,worked_days:d.working_days.map(c=>c.value).join(",")};await p(l,l.worked_days),_.fire({icon:"success",title:"تم",text:"تم تحديث بيانات الموظف بنجاح"}),m("/SystemAdmin/Employees")}catch(l){console.error("Error updating employee:",l),_.fire({icon:"error",title:"خطأ",text:"حدث خطا اثناء تحديث بيانات الموظف"})}finally{n(!1)}},g=()=>{m("/SystemAdmin/Employees")};return r?e.jsx(q,{employee:r,onSubmit:o,onBack:g,formLoading:h}):e.jsx(N,{})};export{ne as default};
