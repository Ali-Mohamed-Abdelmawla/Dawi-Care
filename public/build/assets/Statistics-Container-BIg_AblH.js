import{j as e,R as v,r as p,s as f}from"./index-DF1D02Hj.js";import{T as k,a as y,P as A}from"./personSelect-vLUXfHrd.js";import{s as g,T as b}from"./Typography-D94uCwLm.js";import{T as x}from"./TableCell-CbZ5-y0A.js";import{T as B,a as _,b as E,c as w,d as I}from"./TableRow-Ce_QXQAA.js";import{P as S,u as R}from"./Paper-C9iPag-B.js";import{B as h}from"./Box-D4cKv5_V.js";import{a as $}from"./axios-CyFV80k_.js";import"./mergeSlotProps-BtuCJPHe.js";import"./useSlotProps-C21nwL-b.js";import"./KeyboardArrowRight-nCMYu8V0.js";import"./react-select.esm-DZnH2LNg.js";import"./toPropertyKey-PLuKRk1e.js";const M=g(x)(({theme:t,attendance:r})=>({backgroundColor:r===1?t.palette.success.main:t.palette.error.main,color:t.palette.common.black,textAlign:"center"})),D=g(x)(({theme:t})=>({backgroundColor:t.palette.secondary.dark,color:t.palette.common.white,textAlign:"center"})),W=g(x)(({theme:t})=>({backgroundColor:t.palette.secondary.main,color:t.palette.common.white,width:100,fontWeight:"bold",textAlign:"center"})),N=g(x)(({theme:t})=>({backgroundColor:t.palette.secondary.light,width:150,color:t.palette.common.white,textAlign:"center"})),P=["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"],O=({attendanceData:t})=>{const r=[...t].sort((a,s)=>new Date(a.date).getTime()-new Date(s.date).getTime()),o={};return r.forEach(a=>{const s=new Date(a.date),n=Math.ceil(s.getDate()/7);o[n]||(o[n]=[]),o[n].push(a)}),e.jsx(B,{component:S,children:e.jsxs(_,{children:[e.jsx(E,{children:e.jsxs(w,{children:[e.jsx(D,{colSpan:2,children:"الأسبوع"}),P.map(a=>e.jsx(D,{children:a},a))]})}),e.jsx(I,{children:Object.entries(o).map(([a,s])=>e.jsx(v.Fragment,{children:s.map((n,i)=>{const m=new Date(n.date).getDay();return e.jsxs(w,{children:[i===0&&e.jsxs(W,{rowSpan:s.length,children:["الأسبوع ",a]}),e.jsx(N,{children:n.date}),P.map((u,j)=>j===m?e.jsx(M,{attendance:n.attendance,children:n.attendance===1?"حاضر":"غائب"},u):e.jsx(x,{},u))]},n.date)})},a))})]})})},z=({selectedPerson:t,personType:r,attendanceData:o,noDataMessage:a,handlePersonTypeChange:s,handlePersonChange:n})=>{const i=R();return e.jsxs(h,{sx:{width:"100%"},children:[e.jsxs(k,{value:r,onChange:s,sx:{borderBottom:1,borderColor:"divider",mb:3},indicatorColor:"secondary",children:[e.jsx(y,{label:"طبيب",value:"doctor"}),e.jsx(y,{label:"موظف",value:"employee"})]}),e.jsx(h,{sx:{mt:2},children:e.jsx(A,{personType:r,onChange:n,value:t})}),a?e.jsx(h,{sx:{width:"100%",mt:4,display:"flex",justifyContent:"center",alignItems:"center",height:"300px"},children:e.jsxs(S,{elevation:3,sx:{p:4,textAlign:"center"},children:[e.jsx(b,{variant:"h5",gutterBottom:!0,children:a}),e.jsx(b,{variant:"body1",children:"الرجاء اختيار شخص آخر ."})]})}):o?e.jsx(h,{sx:{width:"100%",mt:4},children:e.jsxs(h,{sx:{mt:4},children:[e.jsxs(b,{variant:"h6",align:"center",sx:{mb:4,borderBottom:1,borderColor:i.palette.dividerColor.main,pb:1},children:["جدول الحضور والغياب لـ ",o.name]}),e.jsx(O,{attendanceData:o.attendance_data})]})}):null]})},F=()=>{const[t,r]=p.useState(null),[o,a]=p.useState("doctor"),[s,n]=p.useState(null),[i,c]=p.useState(null),m=sessionStorage.getItem("accessToken"),u=(d,l)=>{console.log(d),a(l),r(null),c(null)},j=d=>{r(d),c(null)};return p.useEffect(()=>{if(t){const d=o==="doctor"?`/api/get_doctor_attendence/${t.value}`:`/api/get_employee_attendence/${t.value}`;$.get(d,{headers:{Authorization:`Bearer ${m}`,"Content-Type":"application/json"}}).then(l=>{var T,C;(T=l.data)!=null&&T.attendance_data&&((C=l.data)==null?void 0:C.attendance_data.length)>0?(n(l.data),c(null)):(f.fire({title:"لا توجد بيانات",text:"لم يتم العثور على بيانات الحضور لهذا الشخص",icon:"info"}),n(null),c(`لا توجد بيانات حضور لـ "${t.label}"`))}).catch(l=>{console.error(l),f.fire({title:"خطأ",text:"حدث خطأ أثناء جلب البيانات",icon:"error"}),n(null),c("حدث خطأ أثناء جلب البيانات")})}},[t,o,m]),{selectedPerson:t,personType:o,attendanceData:s,noDataMessage:i,handlePersonTypeChange:u,handlePersonChange:j}},te=()=>{const{selectedPerson:t,personType:r,attendanceData:o,noDataMessage:a,handlePersonTypeChange:s,handlePersonChange:n}=F();return e.jsx(z,{selectedPerson:t,personType:r,attendanceData:o,noDataMessage:a,handlePersonTypeChange:s,handlePersonChange:n})};export{te as default};
